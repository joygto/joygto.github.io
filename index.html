<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/joygto.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/joygto.jpg">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="心如花木 向阳而生">
<meta property="og:type" content="website">
<meta property="og:title" content="三米阳光">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="三米阳光">
<meta property="og:description" content="心如花木 向阳而生">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Samy">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>三米阳光</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>
    <a target="_blank" rel="noopener" href="https://github.com/joygto" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">三米阳光</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">开发手札和经验分享</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="categories fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/24/design-first-vs-code-first/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/joygto.jpg">
      <meta itemprop="name" content="Samy">
      <meta itemprop="description" content="心如花木 向阳而生">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="三米阳光">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/24/design-first-vs-code-first/" class="post-title-link" itemprop="url">设计先行 vs 代码先行</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-02-24 21:05:01 / 修改时间：21:07:39" itemprop="dateCreated datePublished" datetime="2021-02-24T21:05:01+08:00">2021-02-24</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="Swagger-Design-First-VS-Code-First"><a href="#Swagger-Design-First-VS-Code-First" class="headerlink" title="Swagger - Design First VS Code First"></a>Swagger - Design First VS Code First</h4><p>Swagger是REST APIs文档生成工具, 它可以使用2种方式编写文档:</p>
<ul>
<li>手动编写Swagger文档，可以利用在线编辑器<a target="_blank" rel="noopener" href="https://editor.swagger.io/#/">Swagger editor</a> 或者是Stoplight.</li>
<li>从代码注释中生成,如@ApiParam, @ApiModelProperty, etc.<br>因为有了2种方式的支持，因此争议的声音出现了：第一种就是design first, 而第二种就是code first</li>
</ul>
<h3 id="优缺点分析"><a href="#优缺点分析" class="headerlink" title="优缺点分析"></a>优缺点分析</h3><h4 id="设计先行的优点"><a href="#设计先行的优点" class="headerlink" title="设计先行的优点"></a>设计先行的优点</h4><ol>
<li>快速搭建一个moc, review, 避免返工</li>
<li>第三方可以并行开发</li>
<li>qa可以提前介入写回归脚本 - 这点其实是理论上，现实往往改API不可测的时候qa还有其他的任务未必有空，而且过早介入写脚本可能还要改</li>
</ol>
<h4 id="设计先行的缺点"><a href="#设计先行的缺点" class="headerlink" title="设计先行的缺点"></a>设计先行的缺点</h4><ol>
<li>swagger editor 的代码生成器不好用，没有办法生成继承这种复杂对象, 意味着文档设计好后代码还得再写一次,简单对象还可以复杂对象帮助不大，如果有用lombok, jsonignore就更用不上</li>
<li>代码ready第一版发布后，将来的改动要体现在文档上的话还要再提交一次，意味着不仅维护代码，还需要维护设计文档，如果是swagger直接文档化的方式比较省事</li>
</ol>
<h4 id="代码先行的优点"><a href="#代码先行的优点" class="headerlink" title="代码先行的优点"></a>代码先行的优点</h4><ol>
<li>文档跟代码一起生成，额外维护文档成本小</li>
<li>当前api开发进度快会因为省去前期设计文档的来回沟通</li>
</ol>
<h4 id="代码先行的缺点"><a href="#代码先行的缺点" class="headerlink" title="代码先行的缺点"></a>代码先行的缺点</h4><ol>
<li>容易返工，尤其是在需求相对不明确的情况下</li>
<li>外部依赖团队需要等待，无法并行开发，整体进度慢</li>
</ol>
<h3 id="总结如下："><a href="#总结如下：" class="headerlink" title="总结如下："></a>总结如下：</h3><ul>
<li>首先设计先行政治正确.</li>
<li>可以视情况而决定，如果调用方不急着对接并且需求明确，或者自己包前后端，那就看跟人喜好代码先行未尝不可. 但如果调用方时间相对紧张那还是设计先行.</li>
</ul>
<h5 id="所以如果一个API是做给内部团队，或者自己包前后端，那代码先行效率高；反之如果是跟外部团队配合，那设计先行总的效率高"><a href="#所以如果一个API是做给内部团队，或者自己包前后端，那代码先行效率高；反之如果是跟外部团队配合，那设计先行总的效率高" class="headerlink" title="所以如果一个API是做给内部团队，或者自己包前后端，那代码先行效率高；反之如果是跟外部团队配合，那设计先行总的效率高."></a>所以如果一个API是做给内部团队，或者自己包前后端，那代码先行效率高；反之如果是跟外部团队配合，那设计先行总的效率高.</h5><h5 id="感觉上就是一个争做甲方的游戏，API端如果做甲方就是代码先行，爱用不用-beauty-如果调用方做甲方，那就是设计先行，先让哥看看是不是满意-设计先行的话review这方的姿态是一个顾问，受到阻力会比较小-不会有赶时间这种借口毕竟你还没开始开发-而代码先行的话review这方受到阻力估计会比较大-容易被认为是挑刺-感觉设计先行可增加就业啊-有需要可以专门审核人员"><a href="#感觉上就是一个争做甲方的游戏，API端如果做甲方就是代码先行，爱用不用-beauty-如果调用方做甲方，那就是设计先行，先让哥看看是不是满意-设计先行的话review这方的姿态是一个顾问，受到阻力会比较小-不会有赶时间这种借口毕竟你还没开始开发-而代码先行的话review这方受到阻力估计会比较大-容易被认为是挑刺-感觉设计先行可增加就业啊-有需要可以专门审核人员" class="headerlink" title="感觉上就是一个争做甲方的游戏，API端如果做甲方就是代码先行，爱用不用 - beauty. 如果调用方做甲方，那就是设计先行，先让哥看看是不是满意. 设计先行的话review这方的姿态是一个顾问，受到阻力会比较小, 不会有赶时间这种借口毕竟你还没开始开发.而代码先行的话review这方受到阻力估计会比较大, 容易被认为是挑刺. 感觉设计先行可增加就业啊,有需要可以专门审核人员."></a>感觉上就是一个争做甲方的游戏，API端如果做甲方就是代码先行，爱用不用 - beauty. 如果调用方做甲方，那就是设计先行，先让哥看看是不是满意. 设计先行的话review这方的姿态是一个顾问，受到阻力会比较小, 不会有赶时间这种借口毕竟你还没开始开发.而代码先行的话review这方受到阻力估计会比较大, 容易被认为是挑刺. 感觉设计先行可增加就业啊,有需要可以专门审核人员.</h5>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/24/spring-boot-cors/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/joygto.jpg">
      <meta itemprop="name" content="Samy">
      <meta itemprop="description" content="心如花木 向阳而生">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="三米阳光">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/24/spring-boot-cors/" class="post-title-link" itemprop="url">spring-boot-cors</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-02-24 21:02:21 / 修改时间：21:02:40" itemprop="dateCreated datePublished" datetime="2021-02-24T21:02:21+08:00">2021-02-24</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="Spring-boot-在跨域访问方面的支持主要有如下几种方式，其中一些是有坑的："><a href="#Spring-boot-在跨域访问方面的支持主要有如下几种方式，其中一些是有坑的：" class="headerlink" title="Spring boot 在跨域访问方面的支持主要有如下几种方式，其中一些是有坑的："></a>Spring boot 在跨域访问方面的支持主要有如下几种方式，其中一些是有坑的：</h4><h3 id="1-实现CorsConfigurationSource接口（推荐）"><a href="#1-实现CorsConfigurationSource接口（推荐）" class="headerlink" title="1. 实现CorsConfigurationSource接口（推荐）"></a>1. 实现CorsConfigurationSource接口（推荐）</h3><p>实现CorsConfigurationSource接口的类:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">@Slf4j</span><br><span class="line">@Component</span><br><span class="line">public class GlobalCorsConfigurationSource implements CorsConfigurationSource &#123;</span><br><span class="line"></span><br><span class="line">    protected static final String ORIGIN &#x3D; &quot;Origin&quot;;</span><br><span class="line">    protected static final Long MAX_AGE &#x3D; 1800L;</span><br><span class="line">    protected static final Boolean ALLOW_CREDENTIALS &#x3D; true;</span><br><span class="line">    protected static final List&lt;String&gt; ALLOW_HEADERS &#x3D; ImmutableList.of(&quot;*&quot;);</span><br><span class="line">    protected static final List&lt;String&gt; ALLOW_HTTP_METHODS &#x3D; ImmutableList.of(&quot;*&quot;);</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private AccessControlProperties accessControlProperties;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public CorsConfiguration getCorsConfiguration(HttpServletRequest request) &#123;</span><br><span class="line">        CorsConfiguration corsConfiguration &#x3D; new CorsConfiguration();</span><br><span class="line"></span><br><span class="line">        final String origin &#x3D; request.getHeader(ORIGIN);</span><br><span class="line">        if (!StringUtils.isBlank(origin) &amp;&amp; isOriginAllowed(origin)) &#123;</span><br><span class="line">            corsConfiguration.setMaxAge(MAX_AGE);</span><br><span class="line">            corsConfiguration.setAllowCredentials(ALLOW_CREDENTIALS);</span><br><span class="line">            corsConfiguration.setAllowedOrigins(Arrays.asList(origin));</span><br><span class="line">            corsConfiguration.setAllowedHeaders(ALLOW_HEADERS);</span><br><span class="line">            corsConfiguration.setAllowedMethods(ALLOW_HTTP_METHODS);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return corsConfiguration;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private boolean isOriginAllowed(final String origin) &#123;</span><br><span class="line">        return isWildcardOrigin() || isOriginMatched(origin);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private boolean isWildcardOrigin() &#123;</span><br><span class="line">        List&lt;String&gt; allowOrigins &#x3D; accessControlProperties.getAllowedOrigins();</span><br><span class="line">        return CollectionUtils.isNotEmpty(allowOrigins)</span><br><span class="line">                &amp;&amp; allowOrigins.size() &#x3D;&#x3D; 1</span><br><span class="line">                &amp;&amp; StringUtils.equals(allowOrigins.get(0), &quot;*&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private boolean isOriginMatched(String origin) &#123;</span><br><span class="line">        List&lt;String&gt; allowedOrigins &#x3D; accessControlProperties.getAllowedOrigins();</span><br><span class="line"></span><br><span class="line">        if (CollectionUtils.isEmpty(allowedOrigins)) &#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        for (String allowedOrigin : allowedOrigins) &#123;</span><br><span class="line">            if (!StringUtils.isEmpty(allowedOrigin)) &#123;</span><br><span class="line">                String allowedOriginTrimStr &#x3D; allowedOrigin.trim();</span><br><span class="line">                if (allowedOriginTrimStr.startsWith(&quot;^&quot;) &amp;&amp; allowedOriginTrimStr.endsWith(&quot;$&quot;)) &#123;</span><br><span class="line">                    Matcher m &#x3D; Pattern.compile(allowedOriginTrimStr).matcher(origin);</span><br><span class="line">                    if (m.find()) &#123;</span><br><span class="line">                        return true;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    if (allowedOriginTrimStr.equals(origin)) &#123;</span><br><span class="line">                        return true;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过WebSecurityConfigurerAdaptor注册：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@EnableWebSecurity</span><br><span class="line">public class WebSecurityConfig extends WebSecurityConfigurerAdapter &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void configure(HttpSecurity http) throws Exception &#123;</span><br><span class="line">        @Override</span><br><span class="line">        protected void configure(HttpSecurity http) throws Exception &#123;</span><br><span class="line">            http</span><br><span class="line">            .cors()</span><br><span class="line">            .configurationSource(globalCorsConfigurationSource)</span><br><span class="line">            .and()</span><br><span class="line">            .csrf()</span><br><span class="line">            .disable()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-通过WebMvcConfigurationSupport注册（推荐）"><a href="#2-通过WebMvcConfigurationSupport注册（推荐）" class="headerlink" title="2. 通过WebMvcConfigurationSupport注册（推荐）"></a>2. 通过WebMvcConfigurationSupport注册（推荐）</h3><p>虽然spring security很普及，但如果确实项目中不需要还可以通过WebMvcConfigurationSupport来添加跨域支持:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">@Slf4j</span><br><span class="line">@Configuration</span><br><span class="line">public class WebMvcConfig extends WebMvcConfigurationSupport &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private Environment env;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private AccessControl accessControl;</span><br><span class="line"></span><br><span class="line">    @PostConstruct</span><br><span class="line">    public void init() &#123;</span><br><span class="line">        log.debug(&quot;Looking for Spring active profiles...&quot;);</span><br><span class="line">        if (env.getActiveProfiles().length &#x3D;&#x3D; 0) &#123;</span><br><span class="line">            log.info(&quot;No Spring profile configured, running with default configuration.&quot;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            log.info(&quot;Detected Spring profiles: &#123;&#125;&quot;, Arrays.asList(env.getActiveProfiles()));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void addResourceHandlers(ResourceHandlerRegistry registry) &#123;</span><br><span class="line">        registry.addResourceHandler(&quot;swagger-ui.html&quot;)</span><br><span class="line">            .addResourceLocations(&quot;classpath:&#x2F;META-INF&#x2F;resources&#x2F;&quot;);</span><br><span class="line">        registry.addResourceHandler(&quot;&#x2F;webjars&#x2F;**&quot;)</span><br><span class="line">            .addResourceLocations(&quot;classpath:&#x2F;META-INF&#x2F;resources&#x2F;webjars&#x2F;&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected RequestMappingHandlerMapping createRequestMappingHandlerMapping() &#123;</span><br><span class="line">        return new ApiVersionRequestMappingHandlerMapping();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void addCorsMappings(CorsRegistry registry) &#123;</span><br><span class="line">        registry.addMapping(&quot;&#x2F;**&quot;)</span><br><span class="line">            .allowedOrigins(accessControl.getAllowOrigin().toArray(new String[accessControl.getAllowOrigin().size()]))</span><br><span class="line">            .allowedMethods(&quot;GET&quot;, &quot;POST&quot;, &quot;PUT&quot;, &quot;DELETE&quot;)</span><br><span class="line">            .allowCredentials(true)</span><br><span class="line">            .maxAge(1800);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-随处可见的拦截器版（不推荐）"><a href="#3-随处可见的拦截器版（不推荐）" class="headerlink" title="3. 随处可见的拦截器版（不推荐）"></a>3. 随处可见的拦截器版（不推荐）</h3><p>原理是通过拦截器拦截请求，在reponse返回到客户端之前加入相应的Header。早在servlet时代类似的功能只能通过Filter实现，所以这个版本“随处可见”。但自从spring web 3.0.2版本后加入了ResponseEntity这个对象后，若控制器返回的是ResponseEntity对象，则会发现Header无法写入，原因在<a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#mvc">spring doc 1.1.6. Interception</a>:</p>
<blockquote>
<p>Note that the postHandle method of HandlerInterceptor is not always ideally suited for use with @ResponseBody and ResponseEntity methods. In such cases an HttpMessageConverter writes to and commits the response before postHandle is called which makes it impossible to change the response, for example to add a header. Instead an application can implement ResponseBodyAdvice and either declare it as an @ControllerAdvice bean or configure it directly on RequestMappingHandlerAdapter.<br>类似的网上2个相关的链接</p>
</blockquote>
<ul>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/48823794/spring-interceptor-doesnt-add-header-to-restcontroller-services">stack overflow</a></li>
<li>[Hugo搭的个人博客] (<a target="_blank" rel="noopener" href="https://mtyurt.net/post/spring-modify-response-headers-after-processing.html">https://mtyurt.net/post/spring-modify-response-headers-after-processing.html</a>)</li>
</ul>
<p>虽然不推荐，但倘若系统约定直接返回对象而非ResponseEntity，非用不可也不是不行，所以还是蛮贴下代码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class CorsInterceptor extends HandlerInterceptorAdapter &#123;</span><br><span class="line"></span><br><span class="line">    private static final String ORIGIN &#x3D; &quot;Origin&quot;;</span><br><span class="line">    private static final String ACCESS_CONTROL_ALLOW_ORIGIN &#x3D; &quot;Access-Control-Allow-Origin&quot;;</span><br><span class="line">    private static final String ACCESS_CONTROL_ALLOW_METHODS &#x3D; &quot;Access-Control-Allow-Methods&quot;;</span><br><span class="line">    private static final String ACCESS_CONTROL_ALLOW_HEADERS &#x3D; &quot;Access-Control-Allow-Headers&quot;;</span><br><span class="line">    private static final String ACCESS_CONTROL_MAX_AGE &#x3D; &quot;Access-Control-Max-Age&quot;;</span><br><span class="line">    private static final String ACCESS_CONTROL_REQUEST_HEADERS &#x3D; &quot;Access-Control-Request-Headers&quot;;</span><br><span class="line">    private static final String ACCESS_CONTROL_ALLOW_CREDENTIALS &#x3D; &quot;Access-Control-Allow-Credentials&quot;;</span><br><span class="line">    private static final String ALLOW_HTTP_METHODS &#x3D; &quot;GET, POST, DELETE, PUT&quot;;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private AccessControl accessControl;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void postHandle(HttpServletRequest request,</span><br><span class="line">                           HttpServletResponse response,</span><br><span class="line">                           Object handler,</span><br><span class="line">                           ModelAndView modelAndView) throws Exception &#123;</span><br><span class="line">        final String origin &#x3D; request.getHeader(ORIGIN);</span><br><span class="line">        if (StringUtils.isBlank(origin) || !validateOrigin(origin)) &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        addCORSHeader(request, response, ACCESS_CONTROL_ALLOW_ORIGIN, origin);</span><br><span class="line">        addCORSHeader(request, response, ACCESS_CONTROL_ALLOW_CREDENTIALS, &quot;true&quot;);</span><br><span class="line">        if (needAddPreflightHeaders(request)) &#123;</span><br><span class="line">            addCORSHeader(request, response, ACCESS_CONTROL_ALLOW_METHODS, ALLOW_HTTP_METHODS);</span><br><span class="line">            String requestHeaders &#x3D; request.getHeader(ACCESS_CONTROL_REQUEST_HEADERS);</span><br><span class="line">            if (StringUtils.isNotBlank(requestHeaders)) &#123;</span><br><span class="line">                addCORSHeader(request, response, ACCESS_CONTROL_ALLOW_HEADERS, requestHeaders);</span><br><span class="line">            &#125;</span><br><span class="line">            addCORSHeader(request, response, ACCESS_CONTROL_MAX_AGE, &quot;1800&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private boolean validateOrigin(final String origin) &#123;</span><br><span class="line">        return isWildcardOrigin() || isOriginAllowed(origin);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private boolean isWildcardOrigin() &#123;</span><br><span class="line">        List&lt;String&gt; allowOrigins &#x3D; accessControl.getAllowOrigin();</span><br><span class="line">        return CollectionUtils.isNotEmpty(allowOrigins)</span><br><span class="line">            &amp;&amp; allowOrigins.size() &#x3D;&#x3D; 1</span><br><span class="line">            &amp;&amp; StringUtils.equals(allowOrigins.get(0), &quot;*&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private boolean isOriginAllowed(final String origin) &#123;</span><br><span class="line">        List&lt;String&gt; allowOrigins &#x3D; accessControl.getAllowOrigin();</span><br><span class="line">        if (CollectionUtils.isEmpty(allowOrigins)) &#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        for (String allowOrigin : allowOrigins) &#123;</span><br><span class="line">            if (origin.contains(allowOrigin)) &#123;</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void addCORSHeader(HttpServletRequest request, HttpServletResponse response, String headerName, String origin) &#123;</span><br><span class="line">        if (StringUtils.isBlank(request.getHeader(headerName))) &#123;</span><br><span class="line">            response.addHeader(headerName, origin);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private boolean needAddPreflightHeaders(HttpServletRequest request) &#123;</span><br><span class="line">        return StringUtils.equals(request.getMethod(), HttpMethod.OPTIONS.name());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-filter的实现（不推荐）"><a href="#4-filter的实现（不推荐）" class="headerlink" title="4. filter的实现（不推荐）"></a>4. filter的实现（不推荐）</h3><p>该版本就很有servlet时代的感觉了，虽然可以解决ResponseEntity使用场景下为Response增加Header的问题，但其实它还存在另一个问题：无法定制HttpStatus.该方法在ResponseEntity场景下返回的HttpStatus都是200，在如今Restful大行其道的今天显然依旧不可取。当然“万事情不抵我愿意”，如果决策者觉得状态码啥的都是浮云也是无话可说，所以照旧蛮贴上代码（临时找不到filter版本，抄了一下上面博主的）:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class DummyFilter extends OncePerRequestFilter &#123;</span><br><span class="line">    @Override</span><br><span class="line">    protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain) throws ServletException, IOException &#123;</span><br><span class="line">        HttpServletResponseWrapper wrapper &#x3D; new HttpServletResponseWrapper(response) &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void setStatus(int sc) &#123;</span><br><span class="line">                super.setStatus(sc);</span><br><span class="line">                handleStatus(sc);</span><br><span class="line">            &#125;</span><br><span class="line">            @Override</span><br><span class="line">            @SuppressWarnings(&quot;deprecation&quot;)</span><br><span class="line">            public void setStatus(int sc, String sm) &#123;</span><br><span class="line">                super.setStatus(sc, sm);</span><br><span class="line">                handleStatus(sc);</span><br><span class="line">            &#125;</span><br><span class="line">            @Override</span><br><span class="line">            public void sendError(int sc, String msg) throws IOException &#123;</span><br><span class="line">                super.sendError(sc, msg);</span><br><span class="line">                handleStatus(sc);</span><br><span class="line">            &#125;</span><br><span class="line">            @Override</span><br><span class="line">            public void sendError(int sc) throws IOException &#123;</span><br><span class="line">                super.sendError(sc);</span><br><span class="line">                handleStatus(sc);</span><br><span class="line">            &#125;</span><br><span class="line">            private void handleStatus(int code) &#123;</span><br><span class="line">                if(code &#x3D;&#x3D; 404)</span><br><span class="line">                    addHeader(&quot;dummy-header, &quot;dummy-value&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        filterChain.doFilter(request, wrapper);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-这次是第5版了，AOP版本，虽然显得逼格略高但没啥用，依-然-不-推-荐"><a href="#5-这次是第5版了，AOP版本，虽然显得逼格略高但没啥用，依-然-不-推-荐" class="headerlink" title="5. 这次是第5版了，AOP版本，虽然显得逼格略高但没啥用，依!然!不!推!荐!"></a>5. 这次是第5版了，AOP版本，虽然显得逼格略高但没啥用，依!然!不!推!荐!</h3><p>不推荐的原因，是因为实际测试过程中发现依旧403。猜测可能是因为当时系统中已经引入了spring security, 有默认的cors设置导致。当然如果项目中没有引入spring security应该是可行，但也会为未来引入spring security埋坑。照例还是贴上代码，没准还是有倔强的人儿呐喊：我就是要用这种方式装逼，系统我说了算将来就是不引入spring security.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">@ControllerAdvice</span><br><span class="line">public class CorsResponseAdvice implements ResponseBodyAdvice&lt;Object&gt; &#123;</span><br><span class="line">    private static final String ACCESS_CONTROL_ALLOW_ORIGIN &#x3D; &quot;Access-Control-Allow-Origin&quot;;</span><br><span class="line">    private static final String ACCESS_CONTROL_ALLOW_METHODS &#x3D; &quot;Access-Control-Allow-Methods&quot;;</span><br><span class="line">    private static final String ACCESS_CONTROL_ALLOW_HEADERS &#x3D; &quot;Access-Control-Allow-Headers&quot;;</span><br><span class="line">    private static final String ACCESS_CONTROL_MAX_AGE &#x3D; &quot;Access-Control-Max-Age&quot;;</span><br><span class="line">    private static final String ACCESS_CONTROL_REQUEST_HEADERS &#x3D; &quot;Access-Control-Request-Headers&quot;;</span><br><span class="line">    private static final String ACCESS_CONTROL_ALLOW_CREDENTIALS &#x3D; &quot;Access-Control-Allow-Credentials&quot;;</span><br><span class="line">    private static final String ALLOW_HTTP_METHODS &#x3D; &quot;GET, POST, DELETE, PUT&quot;;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private AccessControl accessControl;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean supports(MethodParameter methodParameter, Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt; aClass) &#123;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Object beforeBodyWrite(Object body, MethodParameter methodParameter, MediaType mediaType, Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt; aClass, ServerHttpRequest serverHttpRequest, ServerHttpResponse serverHttpResponse) &#123;</span><br><span class="line">        final String origin &#x3D; serverHttpRequest.getHeaders().getOrigin();</span><br><span class="line">        if (StringUtils.isBlank(origin) || !validateOrigin(origin)) &#123;</span><br><span class="line">            return body;</span><br><span class="line">        &#125;</span><br><span class="line">        addCORSHeader(serverHttpRequest, serverHttpResponse, ACCESS_CONTROL_ALLOW_ORIGIN, origin);</span><br><span class="line">        addCORSHeader(serverHttpRequest, serverHttpResponse, ACCESS_CONTROL_ALLOW_CREDENTIALS, &quot;true&quot;);</span><br><span class="line">        if (needAddPreflightHeaders(serverHttpRequest)) &#123;</span><br><span class="line">            addCORSHeader(serverHttpRequest, serverHttpResponse, ACCESS_CONTROL_ALLOW_METHODS, ALLOW_HTTP_METHODS);</span><br><span class="line">            String requestHeaders &#x3D; serverHttpRequest.getHeaders().getFirst(ACCESS_CONTROL_REQUEST_HEADERS);</span><br><span class="line">            if (StringUtils.isNotBlank(requestHeaders)) &#123;</span><br><span class="line">                addCORSHeader(serverHttpRequest, serverHttpResponse, ACCESS_CONTROL_ALLOW_HEADERS, requestHeaders);</span><br><span class="line">            &#125;</span><br><span class="line">            addCORSHeader(serverHttpRequest, serverHttpResponse, ACCESS_CONTROL_MAX_AGE, &quot;1800&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        return body;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void addCORSHeader(ServerHttpRequest request, ServerHttpResponse response, String headerName, String origin) &#123;</span><br><span class="line">        if (StringUtils.isBlank(request.getHeaders().getFirst(headerName))) &#123;</span><br><span class="line">            response.getHeaders().add(headerName, origin);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private boolean needAddPreflightHeaders(ServerHttpRequest request) &#123;</span><br><span class="line">        return StringUtils.equals(request.getMethodValue(), HttpMethod.OPTIONS.name());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private boolean validateOrigin(final String origin) &#123;</span><br><span class="line">        return isWildcardOrigin() || isOriginAllowed(origin);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private boolean isWildcardOrigin() &#123;</span><br><span class="line">        List&lt;String&gt; allowOrigins &#x3D; accessControl.getAllowOrigin();</span><br><span class="line">        return CollectionUtils.isNotEmpty(allowOrigins)</span><br><span class="line">            &amp;&amp; allowOrigins.size() &#x3D;&#x3D; 1</span><br><span class="line">            &amp;&amp; StringUtils.equals(allowOrigins.get(0), &quot;*&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private boolean isOriginAllowed(final String origin) &#123;</span><br><span class="line">        List&lt;String&gt; allowOrigins &#x3D; accessControl.getAllowOrigin();</span><br><span class="line">        if (CollectionUtils.isEmpty(allowOrigins)) &#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        for (String allowOrigin : allowOrigins) &#123;</span><br><span class="line">            if (origin.contains(allowOrigin)) &#123;</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/24/spring-boot-auth/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/joygto.jpg">
      <meta itemprop="name" content="Samy">
      <meta itemprop="description" content="心如花木 向阳而生">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="三米阳光">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/24/spring-boot-auth/" class="post-title-link" itemprop="url">spring-boot-auth</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-02-24 20:59:08 / 修改时间：20:59:57" itemprop="dateCreated datePublished" datetime="2021-02-24T20:59:08+08:00">2021-02-24</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="Spring-boot-授权验证"><a href="#Spring-boot-授权验证" class="headerlink" title="Spring boot 授权验证"></a>Spring boot 授权验证</h4><p>授权认证的使用场景大致上分为2类，一类是账号自己维护在数据库; 另一类是直接使用域用户账号。前者在常见于一些门户网站，或者是面向客户的网站，后者在公司内部系统比较常见。从数据库获取账号验证的方式相对比较容易，所以下面以域用户作为示例，LDAP服务器其实也可以说成是数据库服务器，只不过协议是采用LDAP(LightweightDirectory Access Protocol)。</p>
<h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><h4 id="1-什么是LDAP"><a href="#1-什么是LDAP" class="headerlink" title="1. 什么是LDAP"></a>1. 什么是LDAP</h4><p>LDAP是轻量目录访问协议(LightweightDirectory Access Protocol)的缩写，LDAP标准实际上是在X.500标准基础上产生的一个简化版本。</p>
<h4 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h4><p>LDAP也可以说成是一种数据库，也有client端和server端。server端是用来存放数据，client端用于操作增删改查等操作，通常说的LDAP是指运行这个数据库的服务器。 只不过，LDAP数据库结构为树结构，数据存储在叶子节点上。</p>
<ul>
<li>假设你要树上的一个苹果（一条记录），你怎么告诉园丁它的位置呢？<br>当然首先要说明是哪一棵树（dc，相当于MYSQL的DB），然后是从树根到那个苹果所经过的所有“分叉”（ou），最后就是这个苹果的名字（uid，相当于MySQL表主键id）。好了！这时我们可以清晰的指明这个苹果的位置了，就是那棵“歪脖树”的东边那个分叉上的靠西边那个分叉的再靠北边的分叉上的半红半绿的……</li>
</ul>
<p>因此，在LDAP中，位置可以描述如下</p>
<ul>
<li>树（dc=ljheee)</li>
<li>分叉（ou=bei,ou=xi,ou= dong）</li>
<li>苹果（cn=redApple）</li>
</ul>
<p>因此，苹果redApple的位置为</p>
<ul>
<li>dn:cn=honglv,ou=bei,ou=xi,ou=dong,dc=ljheee</li>
</ul>
<p>dn标识一条记录，描述了数据的详细路径。因此，LDAP树形数据库如下</p>
<ul>
<li>dn(Distinguished Name)：一条记录的详细位置</li>
<li>dc ：一条记录所属区域 (哪一颗树)</li>
<li>ou(Organization Unit) ：一条记录所属组织 （哪一个分支）</li>
<li>cn/uid：一条记录的名字/ID (哪一个苹果名字)</li>
<li>LDAP目录树的最顶部就是根，也就是所谓的“基准DN”</li>
</ul>
<p>因此，LDAP树形结构在存储大量数据时，查询效率更高，实现迅速查找，可以应用于域验证等。</p>
<h4 id="LDAP命名格式"><a href="#LDAP命名格式" class="headerlink" title="LDAP命名格式"></a>LDAP命名格式</h4><p>LDAP协议中采用的命名格式常用的有如下两种：LDAP URL 和X.500。<br>任何一个支持LDAP 的客户都可以利用LDAP名通过LDAP 协议访问活动目录，LDAP 名不像普通的Internet URL 名字那么直观，但是LDAP 名往往隐藏在 应用系统的内部，最终用户很少直接使用LDAP 名。LDAP 名使用X.500 命名规 范，也称为属性化命名法，包括活动目录服务所在的服务器以及对象的属性信息。</p>
<h4 id="2-什么是AD"><a href="#2-什么是AD" class="headerlink" title="2. 什么是AD"></a>2. 什么是AD</h4><p>AD是Active Directory的缩写，AD是LDAP的一个应用实例，而不应该是LDAP本身。比如：windows域控的用户、权限管理应该是微软公司使用LDAP存储了一些数据来解决域控这个具体问题，只是AD顺便还提供了用户接口，也可以利用ActiveDirectory当做LDAP服务器存放一些自己的东西而已。比如LDAP是关系型数据库，微软自己在库中建立了几个表，每个表都定义好了字段。显然这些表和字段都是根据微软自己的需求定制的，而不是LDAP协议的规定。然后微软将LDAP做了一些封装接口，用户可以利用这些接口写程序操作LDAP，使得ActiveDirectory也成了一个LDAP服务器。</p>
<p>作用</p>
<p>用户服务</p>
<p>管理用户的域账号、用户信息、企业通信录（与电子邮箱系统集成）、用户组管理、用户身份认证、用户授权管理、按需实施组管理策略等。这里不单单指某些线上的应用更多的是指真实的计算机，服务器等。</p>
<p>计算机管理</p>
<p>管理服务器及客户端计算机账户、所有服务器及客户端计算机加入域管理并按需实施组策略。</p>
<p>资源管理</p>
<p>管理打印机、文件共享服务、网络资源等实施组策略。</p>
<p>应用系统的支持</p>
<p>对于电子邮件（Exchange）、在线及时通讯（Lync）、企业信息管理（SharePoint）、微软CRM,ERP等业务系统提供数据认证（身份认证、数据集成、组织规则等）。这里不单是微软产品的集成，其它的业务系统根据公用接口的方式一样可以嵌入进来。</p>
<p>客户端桌面管理</p>
<p>系统管理员可以集中的配置各种桌面配置策略，如：用户适用域中资源权限限制、界面功能的限制、应用程序执行特征的限制、网络连接限制、安全配置限制等。</p>
<p>更多关于LDAP和AD的内容可以参考<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/46324379">知乎文章</a></p>
<h3 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h3><h4 id="1-引入需要的一些lib包"><a href="#1-引入需要的一些lib包" class="headerlink" title="1. 引入需要的一些lib包"></a>1. 引入需要的一些lib包</h4><p>利用spring boot 4大特性中的起步依赖引入ldap和security:</p>
<ol>
<li><p>自动配置 -Auto Configuration</p>
</li>
<li><p><strong>起步依赖-Starter Dependency</strong></p>
</li>
<li><p>命令行界面-Spring Boot CLI</p>
</li>
<li><p>运行监控-Actuator</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;spring-boot-starter-security&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.springframework.security&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;spring-security-ldap&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br></pre></td></tr></table></figure>
<h4 id="2-spring-WebSecurityConfigurerAdapter-配置"><a href="#2-spring-WebSecurityConfigurerAdapter-配置" class="headerlink" title="2. spring WebSecurityConfigurerAdapter 配置"></a>2. spring WebSecurityConfigurerAdapter 配置</h4></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@EnableWebSecurity</span><br><span class="line">@Profile(&quot;!test&quot;)</span><br><span class="line">public class WebSecurityConfig extends WebSecurityConfigurerAdapter &#123;</span><br><span class="line"></span><br><span class="line">    @Value(&quot;$&#123;ldap.urls&#125;&quot;)</span><br><span class="line">    private String ldapUrls;</span><br><span class="line"></span><br><span class="line">    @Value(&quot;$&#123;ldap.base.dn&#125;&quot;)</span><br><span class="line">    private String ldapBaseDn;</span><br><span class="line"></span><br><span class="line">    @Value(&quot;$&#123;ldap.username&#125;&quot;)</span><br><span class="line">    private String ldapSecurityPrincipal;</span><br><span class="line"></span><br><span class="line">    @Value(&quot;$&#123;ldap.password&#125;&quot;)</span><br><span class="line">    private String ldapPrincipalPassword;</span><br><span class="line"></span><br><span class="line">    @Value(&quot;$&#123;ldap.user.search&#125;&quot;)</span><br><span class="line">    private String ldapUserSearch;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private CustomBasicAuthenticationEntryPoint authenticationEntryPoint;</span><br><span class="line">    @Autowired</span><br><span class="line">    private UserRoleService userRoleService;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void configure(HttpSecurity http) throws Exception &#123;</span><br><span class="line">        http.sessionManagement()</span><br><span class="line">            .sessionCreationPolicy(SessionCreationPolicy.STATELESS)</span><br><span class="line">            .and()</span><br><span class="line">            .cors()</span><br><span class="line">            .and()</span><br><span class="line">            .csrf()</span><br><span class="line">            .disable()</span><br><span class="line">            .authorizeRequests()</span><br><span class="line">            .antMatchers(&quot;&#x2F;v2&#x2F;api-docs&quot;,</span><br><span class="line">                &quot;&#x2F;configuration&#x2F;ui&quot;,</span><br><span class="line">                &quot;&#x2F;swagger-resources&#x2F;**&quot;,</span><br><span class="line">                &quot;&#x2F;configuration&#x2F;security&quot;,</span><br><span class="line">                &quot;&#x2F;swagger-ui.html&quot;,</span><br><span class="line">                &quot;&#x2F;&quot;,</span><br><span class="line">                &quot;&#x2F;csrf&quot;,</span><br><span class="line">                &quot;&#x2F;webjars&#x2F;**&quot;).permitAll()</span><br><span class="line">            .anyRequest().authenticated()</span><br><span class="line">            .and()</span><br><span class="line">            .httpBasic()</span><br><span class="line">            .authenticationEntryPoint(authenticationEntryPoint)</span><br><span class="line">            .and()</span><br><span class="line">            .addFilter(new JWTAuthenticationFilter(authenticationManager()))</span><br><span class="line">            .addFilter(new JWTAuthorizationFilter(authenticationManager(), userRoleService));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void configure(AuthenticationManagerBuilder auth) throws Exception &#123;</span><br><span class="line">        auth.ldapAuthentication()</span><br><span class="line">            .userDetailsContextMapper(new CustomLdapUserDetailsMapper())</span><br><span class="line">            .contextSource()</span><br><span class="line">            .url(ldapUrls + ldapBaseDn)</span><br><span class="line">            .managerDn(ldapSecurityPrincipal)</span><br><span class="line">            .managerPassword(EncryptUtil.decrypt(ldapPrincipalPassword))</span><br><span class="line">            .and()</span><br><span class="line">            .userSearchFilter(ldapUserSearch);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public HttpFirewall defaultHttpFirewall() &#123;</span><br><span class="line">        return new DefaultHttpFirewall();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中有这几行最重要：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.httpBasic()</span><br><span class="line">.authenticationEntryPoint(authenticationEntryPoint)</span><br><span class="line">.and()</span><br><span class="line">.addFilter(new JWTAuthenticationFilter(authenticationManager()))</span><br><span class="line">.addFilter(new JWTAuthorizationFilter(authenticationManager(), userRoleService));</span><br></pre></td></tr></table></figure>
<ul>
<li><p>httpBasic，用于开启basic验证，具体体现在页面就是会跳出一个对话框要求输入用户名和密码；体现在非页面的调用则是header里面需要带上Authorization，值的格式为：Basic base64密文（其中Basic后面有个空格）</p>
</li>
<li><p>authenticationEntryPoint，作用是当授权失败时的处理</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class CustomBasicAuthenticationEntryPoint extends BasicAuthenticationEntryPoint &#123;</span><br><span class="line"></span><br><span class="line">    private static final RequestMatcher REQUEST_MATCHER &#x3D; new ELRequestMatcher(&quot;hasHeader(&#39;X-Requested-With&#39;,&#39;XMLHttpRequest&#39;)&quot;);</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void afterPropertiesSet() &#123;</span><br><span class="line">        setRealmName(&quot;My Realm&quot;);</span><br><span class="line">        super.afterPropertiesSet();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void commence(HttpServletRequest request, HttpServletResponse response, AuthenticationException authException) throws IOException &#123;</span><br><span class="line">        if (isPreflight(request)) &#123;</span><br><span class="line">            response.setStatus(HttpServletResponse.SC_NO_CONTENT);</span><br><span class="line">        &#125; else if (isRestRequest(request)) &#123;</span><br><span class="line">            response.sendError(HttpServletResponse.SC_UNAUTHORIZED, &quot;Unauthorized&quot;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            super.commence(request, response, authException);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private boolean isPreflight(HttpServletRequest request) &#123;</span><br><span class="line">        return &quot;OPTIONS&quot;.equals(request.getMethod());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected boolean isRestRequest(HttpServletRequest request) &#123;</span><br><span class="line">        return REQUEST_MATCHER.matches(request);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>JWTAuthenticationFilter，该过滤器用于登录。继承自UsernamePasswordAuthenticationFilter，默认的URL是/login:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public UsernamePasswordAuthenticationFilter() &#123;</span><br><span class="line">        super(new AntPathRequestMatcher(&quot;&#x2F;login&quot;, &quot;POST&quot;));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>该过滤器主要定制2个方法的实现：尝试授权以及成功授权后返回token给前端：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">public class JWTAuthenticationFilter extends UsernamePasswordAuthenticationFilter &#123;</span><br><span class="line"></span><br><span class="line">    private AuthenticationManager authenticationManager;</span><br><span class="line"></span><br><span class="line">    public JWTAuthenticationFilter(AuthenticationManager authenticationManager) &#123;</span><br><span class="line">        this.authenticationManager &#x3D; authenticationManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Authentication attemptAuthentication(HttpServletRequest request, HttpServletResponse response) throws AuthenticationException &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            UserDTO user &#x3D; new ObjectMapper().readValue(request.getInputStream(), UserDTO.class);</span><br><span class="line">            Authentication authentication &#x3D; this.authenticationManager.authenticate(new UsernamePasswordAuthenticationToken(user.getUserId(), user.getPassword()));</span><br><span class="line">            return authentication;</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            throw new RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void successfulAuthentication(HttpServletRequest request, HttpServletResponse response, FilterChain chain, Authentication authResult) throws IOException, ServletException &#123;</span><br><span class="line">        CustomLdapUserDetails user &#x3D; (CustomLdapUserDetails) authResult.getPrincipal();</span><br><span class="line"></span><br><span class="line">        Claims claims &#x3D; Jwts.claims().setSubject(user.getUsername());</span><br><span class="line">        claims.put(&quot;displayName&quot;, user.getDisplayName());</span><br><span class="line">        claims.put(&quot;email&quot;, user.getEmail());</span><br><span class="line">        String token &#x3D; Jwts.builder()</span><br><span class="line">            .setClaims(claims)</span><br><span class="line">            .setExpiration(new Date(System.currentTimeMillis() + EXPIRATION_TIME))</span><br><span class="line">            .signWith(SignatureAlgorithm.HS512, SECRET)</span><br><span class="line">            .compact();</span><br><span class="line">        response.addHeader(HEADER_STRING, TOKEN_PREFIX + token);</span><br><span class="line">        response.addHeader(&quot;Content-Type&quot;, &quot;application&#x2F;json&quot;);</span><br><span class="line"></span><br><span class="line">        response.getWriter().append(String.format(&quot;&#123;\&quot;token\&quot;:\&quot;%s\&quot;&#125;&quot;, token));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>JWTAuthorizationFilter，也是校验，区别在于针对的token校验以及外加授权,跟httpBasic()方式类似，只不过httpBasic()方法会自动添加一个BasicAuthenticationFilter用于basic验证，而这里的JWTAuthorizationFilter则是自定义的用于token的校验：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">public class JWTAuthorizationFilter extends BasicAuthenticationFilter &#123;</span><br><span class="line"></span><br><span class="line">    private static final Logger LOGGER &#x3D; LoggerFactory.getLogger(JWTAuthorizationFilter.class);</span><br><span class="line"></span><br><span class="line">    private UserRoleService userRoleService;</span><br><span class="line"></span><br><span class="line">    public JWTAuthorizationFilter(AuthenticationManager authenticationManager, UserRoleService userRoleService) &#123;</span><br><span class="line">        super(authenticationManager);</span><br><span class="line">        this.userRoleService &#x3D; userRoleService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain chain) throws IOException, ServletException &#123;</span><br><span class="line">        String header &#x3D; request.getHeader(HEADER_STRING);</span><br><span class="line"></span><br><span class="line">        if (header &#x3D;&#x3D; null || !header.startsWith(TOKEN_PREFIX)) &#123;</span><br><span class="line">            chain.doFilter(request, response);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        UserDTO user &#x3D; getUser(request);</span><br><span class="line">        if (user !&#x3D; null) &#123;</span><br><span class="line">            SecurityContextHolder.getContext().setAuthentication(user);</span><br><span class="line">        &#125;</span><br><span class="line">        chain.doFilter(request, response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private UserDTO getUser(HttpServletRequest request) &#123;</span><br><span class="line">        String token &#x3D; request.getHeader(HEADER_STRING);</span><br><span class="line">        if (token !&#x3D; null) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                Claims body &#x3D; Jwts.parser()</span><br><span class="line">                    .setSigningKey(SECRET)</span><br><span class="line">                    .parseClaimsJws(token.replace(TOKEN_PREFIX, &quot;&quot;))</span><br><span class="line">                    .getBody();</span><br><span class="line">                if (body !&#x3D; null) &#123;</span><br><span class="line">                    UserDTO user &#x3D; new UserDTO(body.getSubject(), (String) body.get(&quot;displayName&quot;), (String) body.get(&quot;email&quot;));</span><br><span class="line">                    user.setRoles(userRoleService.getRoles(user.getUserId()));</span><br><span class="line">                    return user;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; catch (Exception e) &#123;</span><br><span class="line">                LOGGER.warn(&quot;Cannot parse token&quot;, e);</span><br><span class="line">                return null;</span><br><span class="line">            &#125;</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后关于LDAP的部分，如之前所说，类似数据库的访问，区别在于访问的方式：</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">    protected void configure(AuthenticationManagerBuilder auth) throws Exception &#123;</span><br><span class="line">        auth.ldapAuthentication()</span><br><span class="line">            .userDetailsContextMapper(new CustomLdapUserDetailsMapper())</span><br><span class="line">            .contextSource()</span><br><span class="line">            .url(ldapUrls + ldapBaseDn)</span><br><span class="line">            .managerDn(ldapSecurityPrincipal)</span><br><span class="line">            .managerPassword(EncryptUtil.decrypt(ldapPrincipalPassword))</span><br><span class="line">            .and()</span><br><span class="line">            .userSearchFilter(ldapUserSearch);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>其中，CustomLdapUserDetailsMapper封装了原有的LDAPUser的一些信息，多提供了mail以及displayname：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public class CustomLdapUserDetailsMapper extends LdapUserDetailsMapper &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public UserDetails mapUserFromContext(DirContextOperations ctx, String username, Collection&lt;? extends GrantedAuthority&gt; authorities) &#123;</span><br><span class="line">        LdapUserDetailsImpl ldapUserDetails &#x3D; (LdapUserDetailsImpl) super.mapUserFromContext(ctx, username, authorities);</span><br><span class="line"></span><br><span class="line">        CustomLdapUserDetails customLdapUserDetails &#x3D; new CustomLdapUserDetails(ldapUserDetails);</span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line">            customLdapUserDetails.setEmail((String) ctx.getAttributes().get(&quot;mail&quot;).get());</span><br><span class="line">            customLdapUserDetails.setDisplayName((String) ctx.getAttributes().get(&quot;displayname&quot;).get());</span><br><span class="line">        &#125; catch (NamingException e) &#123;</span><br><span class="line">            throw new IllegalStateException(&quot;Could not get ldap attributes.&quot;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return customLdapUserDetails;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中wrapper的类：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public class CustomLdapUserDetails implements LdapUserDetails &#123;</span><br><span class="line"></span><br><span class="line">    private String email;</span><br><span class="line"></span><br><span class="line">    private String displayName;</span><br><span class="line"></span><br><span class="line">    private LdapUserDetails details;</span><br><span class="line"></span><br><span class="line">    public CustomLdapUserDetails(LdapUserDetails details) &#123;</span><br><span class="line">        this.details &#x3D; details;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后贴一下ldap的配置:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ldap:</span><br><span class="line">  urls: ldaps:&#x2F;&#x2F;sjqadc-ldaps.ehi.ehealth.com:636&#x2F;</span><br><span class="line">  base:</span><br><span class="line">    dn: OU&#x3D;EHI,DC&#x3D;ehi,DC&#x3D;ehealth,DC&#x3D;com</span><br><span class="line">  username: ehiboldap</span><br><span class="line">  password: ulAgyY4PD6VLmV9o41POUX4XMN22fa&#x2F;2</span><br><span class="line">  user:</span><br><span class="line">    search: (sAMAccountName&#x3D;&#123;0&#125;)</span><br></pre></td></tr></table></figure>
<p>其中密码是base64 encrypted</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public static String decrypt(String secure) &#123;</span><br><span class="line">        byte[] decrypted &#x3D; decrypt(base64Decoder(secure));</span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line">            return new String(decrypted, &quot;UTF-8&quot;);</span><br><span class="line">        &#125; catch (UnsupportedEncodingException var3) &#123;</span><br><span class="line">            throw new RuntimeException(var3);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">public static byte[] base64Decoder(String dest) &#123;</span><br><span class="line">        BASE64Decoder decoder &#x3D; new BASE64Decoder();</span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line">            return decoder.decodeBuffer(dest);</span><br><span class="line">        &#125; catch (IOException var3) &#123;</span><br><span class="line">            throw new RuntimeException(var3);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后贴一个产生basic验证里Authorization的base64密文的方法（用户名:密码)：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String newKey &#x3D; (new BASE64Encoder()).encodeBuffer(&quot;username:password&quot;.getBytes());</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/24/hexo-introduction/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/joygto.jpg">
      <meta itemprop="name" content="Samy">
      <meta itemprop="description" content="心如花木 向阳而生">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="三米阳光">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/24/hexo-introduction/" class="post-title-link" itemprop="url">使用hexo开发个人博客</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-02-24 20:54:24 / 修改时间：20:56:23" itemprop="dateCreated datePublished" datetime="2021-02-24T20:54:24+08:00">2021-02-24</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/hexo/" itemprop="url" rel="index"><span itemprop="name">hexo</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="关于hexo"><a href="#关于hexo" class="headerlink" title="关于hexo"></a>关于hexo</h2><p>Hexo 是一款基于 Node.js 的快速的、简单的博客框架，能够创建一个项目进行编辑后生成一套静态网页，比较适合个人博客搭建。因为 Hexo 生成的网页不依赖数据库和任何 Web 工具，所以可以把它放在 Github 空间或七牛云储存上，然后配置好域名以后进行访问。VPS 和独立服务器用户也可以在自己的服务器上安装好 Hexo，配合 Apache 或者 nignx 即可访问。适合 Windows/Mac/Linux 用户使用。另外 Hexo 支持 Markdown 语法，所以用户可以很快的撰写每一篇博文。Hexo比较适合初学者适应并快速地了解 Web。</p>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><h3 id="安装hexo"><a href="#安装hexo" class="headerlink" title="安装hexo"></a>安装hexo</h3><p>Hexo 是基于 Node.js 的第三方模块，所以我们需要对其进行单独安装。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npm install -g hexo-cli</span><br><span class="line">hexo init myBlog</span><br><span class="line">cd myBlog</span><br><span class="line">npm i</span><br></pre></td></tr></table></figure>
<p><em>如果有碰见SyntaxError: Invalid regular expression flags这个错误的原因是因为node的正则写法使用了/, node8版本还是会有这个问题, 升级node版本就行.</em></p>
<p>然后打开myBlog目录中的_config.yml，稍微做一点配置。</p>
<ul>
<li>第6行title, 改为网站的名字.</li>
<li>第9行author, 改为作者的名字.</li>
<li>最后一行type改为 type: git</li>
<li>最后一行添加 repo: {你的仓库地址}</li>
</ul>
<h3 id="生成静态网页并试运行"><a href="#生成静态网页并试运行" class="headerlink" title="生成静态网页并试运行"></a>生成静态网页并试运行</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo generate &#x2F;** 生成一套静态网页 **&#x2F;</span><br><span class="line">hexo server &#x2F;** 在服务器上运行 **&#x2F;</span><br></pre></td></tr></table></figure>
<h3 id="发布文章"><a href="#发布文章" class="headerlink" title="发布文章"></a>发布文章</h3><p>博客当然是要用来写文章的, 而发布文章的流程也同样很简单</p>
<ol>
<li>执行 hexo new 文章名称 。</li>
<li>进入source/_posts目录，打开刚刚新建的文章，开始创作。</li>
<li>写完文章后执行 hexo generate 生成修改后的博客页面。</li>
<li>再执行 hexo deploy 就可以发布到github了。</li>
</ol>
<h3 id="修改主题"><a href="#修改主题" class="headerlink" title="修改主题"></a>修改主题</h3><p>主题当然也是可以换的</p>
<ol>
<li>从<a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/wiki/Themes">这里</a>挑一个自己看着顺眼的主题，复制它的clone地址。</li>
<li>执行 git clone <a href="mailto:git@github.com">git@github.com</a>:iissnan/hexo-theme-next.git</li>
<li>themes/{主题名字} 下载主题。</li>
<li>修改_config.yml文件75行为刚刚下载的主题名字。</li>
<li>执行 hexo generate 和 hexo deploy 打包发布。</li>
</ol>
<p>这样就完成了.</p>
<h2 id="部署方案一览"><a href="#部署方案一览" class="headerlink" title="部署方案一览"></a>部署方案一览</h2><p>开发完成后下一阶段的任务就是部署, 一般来说有3条路线:</p>
<ol>
<li>本地开发完成后将publish文件夹放到apache服务器上</li>
<li>直接是跟github做绑定, 通过github访问</li>
<li>在部署的服务器上搭建git私服,通过post-update的hook更新到目标文件夹（该方案最优, 故本文将阐述该方案）</li>
</ol>
<h3 id="创建git账号-非必需-图省事可直接用root账号"><a href="#创建git账号-非必需-图省事可直接用root账号" class="headerlink" title="创建git账号(非必需,图省事可直接用root账号)"></a>创建git账号(非必需,图省事可直接用root账号)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">adduser git</span><br><span class="line">chmod 740 &#x2F;etc&#x2F;sudoers</span><br><span class="line">vim &#x2F;etc&#x2F;sudoers</span><br></pre></td></tr></table></figure>
<ul>
<li><p>添加内容</p>
<ul>
<li><p>找到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">## Allow root to run any commands anywhere</span><br><span class="line">root    ALL&#x3D;(ALL)     ALL</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>添加以下内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git ALL&#x3D;(ALL) ALL</span><br></pre></td></tr></table></figure>
<ul>
<li>保存退出并改回权限  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 400 /etc/sudoers</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>设置git账户密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo passwd git</span><br></pre></td></tr></table></figure></li>
<li><p>在本地终端中测试是否能免密登录git</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -v git@SERVER</span><br></pre></td></tr></table></figure></li>
<li><p>其中SERVER为填写自己的云主机IP, 或者域名</p>
</li>
</ul>
<h3 id="创建目录"><a href="#创建目录" class="headerlink" title="创建目录"></a>创建目录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># git仓库目录</span><br><span class="line">mkdir &#x2F;root&#x2F;git_repo</span><br><span class="line"># 网站根目录</span><br><span class="line">mkdir &#x2F;data&#x2F;hexo-blog</span><br></pre></td></tr></table></figure>
<h3 id="使用git自动化部署博客"><a href="#使用git自动化部署博客" class="headerlink" title="使用git自动化部署博客"></a>使用git自动化部署博客</h3><ul>
<li><p>服务器建立裸库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;root&#x2F;git_repo</span><br><span class="line">git init --bare hexo-blog.git</span><br></pre></td></tr></table></figure></li>
<li><p>使用 git-hooks 同步网站根目录</p>
<ul>
<li><p>在这里我们使用的是 post-update这个钩子. 当git有收发的时候就会调用这个钩子。 在 /root/git_repo/hexo-blog.git 裸库的 hooks文件夹中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim &#x2F;root&#x2F;git_repo&#x2F;hexo-blog.git&#x2F;hooks&#x2F;post-update</span><br><span class="line"># 编辑文件，写入以下内容</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;sh</span><br><span class="line">git --work-tree&#x3D;&#x2F;var&#x2F;www&#x2F;hexo --git-dir&#x3D;&#x2F;var&#x2F;repo&#x2F;blog.git checkout -f</span><br></pre></td></tr></table></figure>
<ul>
<li>保存后，要赋予这个文件可执行权限  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x post-update</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
<li><p>配置_config.yml,完成自动化部署</p>
<ul>
<li><p>打开_config.yml, 找到deploy</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">type: git</span><br><span class="line">repo:</span><br><span class="line">    github: </span><br><span class="line">        git@github.com:Finhoo&#x2F;Finhoo.github.io.git</span><br><span class="line">    www:</span><br><span class="line">        root@www.everyeyes.com:&#x2F;root&#x2F;git_repo&#x2F;hexo-blog.git</span><br><span class="line">branch: master</span><br></pre></td></tr></table></figure></li>
<li><p>因为我们是采用www方式，所以具体配置为:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">type: git</span><br><span class="line">repo: root@www.everyeyes.com:&#x2F;root&#x2F;git_repo&#x2F;hexo-blog.git</span><br><span class="line">branch: master</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>保存后，即可测试部署</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo clean </span><br><span class="line">hexo g -d</span><br></pre></td></tr></table></figure>
<ul>
<li><p>其中用到了一些命令缩写, 和下面两个命令的作用是相同的:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo generate --deploy</span><br><span class="line">hexo deploy --generate</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>如果出现错误： ERROR Deployer not found: git，执行:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -save hexo-deployer-git</span><br></pre></td></tr></table></figure>
<h3 id="最后一步就是配置apache"><a href="#最后一步就是配置apache" class="headerlink" title="最后一步就是配置apache"></a>最后一步就是配置apache</h3></li>
<li><p>DocumentRoot “/data/hexo-blog”</p>
</li>
<li><p>&lt;Directory “/data/hexo-blog”&gt;</p>
</li>
</ul>
<h3 id="重启apache查看效果"><a href="#重启apache查看效果" class="headerlink" title="重启apache查看效果"></a>重启apache查看效果</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service httpd restart</span><br></pre></td></tr></table></figure>
<h3 id="文档"><a href="#文档" class="headerlink" title="文档"></a>文档</h3><ul>
<li><a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/docs/">hexo</a></li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000010613172">segmentfault</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/24/playframework-disadvantage/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/joygto.jpg">
      <meta itemprop="name" content="Samy">
      <meta itemprop="description" content="心如花木 向阳而生">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="三米阳光">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/24/playframework-disadvantage/" class="post-title-link" itemprop="url">Play (1.x) 的几个硬伤</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-02-24 20:49:34 / 修改时间：21:05:54" itemprop="dateCreated datePublished" datetime="2021-02-24T20:49:34+08:00">2021-02-24</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/play-1-x/" itemprop="url" rel="index"><span itemprop="name">play 1.x</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="Play-Framework是一个开源的Web框架，背后商业公司是Typesafe。要介绍Play之前，首先理清Play的两个不同的分支。-Play-1-x-使用Java开发，最新版本是1-3-1，只支持Java项目。从11年开始就进入了维护阶段，新项目一般不考虑使用Play1。-Play-2-x-使用Scala和Java开发，同时支持Java和Scala项目。因为Play2主要由Scala开发，鉴于本人对Scala不熟因此采用Play1作为试水框架开发一个宠物商店，以下是开发过程中发现的一些特性及心得感悟，但鉴于表述能力及偷懒，内容摘自网络并做小量修改："><a href="#Play-Framework是一个开源的Web框架，背后商业公司是Typesafe。要介绍Play之前，首先理清Play的两个不同的分支。-Play-1-x-使用Java开发，最新版本是1-3-1，只支持Java项目。从11年开始就进入了维护阶段，新项目一般不考虑使用Play1。-Play-2-x-使用Scala和Java开发，同时支持Java和Scala项目。因为Play2主要由Scala开发，鉴于本人对Scala不熟因此采用Play1作为试水框架开发一个宠物商店，以下是开发过程中发现的一些特性及心得感悟，但鉴于表述能力及偷懒，内容摘自网络并做小量修改：" class="headerlink" title="Play Framework是一个开源的Web框架，背后商业公司是Typesafe。要介绍Play之前，首先理清Play的两个不同的分支。 Play 1.x 使用Java开发，最新版本是1.3.1，只支持Java项目。从11年开始就进入了维护阶段，新项目一般不考虑使用Play1。 Play 2.x 使用Scala和Java开发，同时支持Java和Scala项目。因为Play2主要由Scala开发，鉴于本人对Scala不熟因此采用Play1作为试水框架开发一个宠物商店，以下是开发过程中发现的一些特性及心得感悟，但鉴于表述能力及偷懒，内容摘自网络并做小量修改："></a>Play Framework是一个开源的Web框架，背后商业公司是Typesafe。要介绍Play之前，首先理清Play的两个不同的分支。 Play 1.x 使用Java开发，最新版本是1.3.1，只支持Java项目。从11年开始就进入了维护阶段，新项目一般不考虑使用Play1。 Play 2.x 使用Scala和Java开发，同时支持Java和Scala项目。因为Play2主要由Scala开发，鉴于本人对Scala不熟因此采用Play1作为试水框架开发一个宠物商店，以下是开发过程中发现的一些特性及心得感悟，但鉴于表述能力及偷懒，内容摘自网络并做小量修改：</h4><h3 id="1-不支持j2ee"><a href="#1-不支持j2ee" class="headerlink" title="1. 不支持j2ee"></a>1. 不支持j2ee</h3><blockquote>
<p>Play号称基于nio的event驱动，自行实现了http协议，比之传统j2ee应用性能高出无数云云，因此，使用Play，无需用到j2ee容器，也没有servlet/jsp的概念，只需要jvm，然后run就可以了。看上去的确很美好，然后一个很基本的事实是，除了个人的玩具应用，有哪个企业的IT管理员会愿意在已经熟悉的j2ee环境上在出现一个新的环境？更基本的事实是，从管理的角度来说，play提供的容器，能够达到j2ee规范的高度吗？更更基本的事实是，你能够相信它的安全性吗？虽然tomcat也会有安全漏洞，虽然jetty也不见得就真的安全，虽然websphere和weblogic都是要花钱的，但是比起他们来，你会更相信play的容器吗？我相信99%的答案是No。 （当然，有一个第三方插件项目在试图帮助Play部署war，但就其官方的态度而言，我是完全无法赞同的，而且，那个插件项目，远未到成熟的地步，因为Play从根子上就没有打算遵循j2ee规范)</p>
</blockquote>
<p>(这个估计就是Play没有推广起来的原因,无法跟已有成熟的结合,推行成本太大)</p>
<h3 id="2-没有服务端session"><a href="#2-没有服务端session" class="headerlink" title="2. 没有服务端session"></a>2. 没有服务端session</h3><blockquote>
<p>Play的口号是stateless，但我并不认为这个可以成为不提供服务端session的理由，现实生活中大部分的网站还是需要session的，你哪怕提供一个插件来提供session功能也好啊，可是很遗憾，没有，官方的文档上说，请自行处理。。。自行处理。。。这个世界上还有程序员有兴趣去实现一个session管理吗？</p>
</blockquote>
<p>(好吧，我终究还是利用cookie和数据库自行实现，因为框架的使用方式更倾向于struts或者spring mvc那套，前后端还是比较紧密需要会话)</p>
<h3 id="3-编译成函数的模板"><a href="#3-编译成函数的模板" class="headerlink" title="3. 编译成函数的模板"></a>3. 编译成函数的模板</h3><blockquote>
<p>Play认为这是它的优点，静态编译的模板，类型安全的参数传递。但我却被它彻底的打败了，为了向被各个页面复用的page top传递几个参数，我需要在每一个直接引用到它的模板，以及每一个间接引用到它的模板上添加所有的参数以便传递，因为，调用模板其实就是调用函数啊，我必须传递参数啊。。。当然，幸运的是，我们用的是scala, scala有implict参数定义，oh my God，我不需要传递参数了。。。可惜的是，我仍然需要在每一个层次的模板上声明必须的参数，这是怎样的一种精神，这是精神分裂的前兆。。。更加麻烦的是国际化与本地化处理， Play提供了一个getmessage的函数让我们可以取得本地化字符串并且填入参数，功能很简单，当然，这并不妨碍我直接使用JDK的国际化API，因此这倒算不上它有多罪恶，然而，在表现层，或者说view层，当我希望根据locale选择一个不同的模板文件的时候，问题就麻烦了，静态编译的模板，类型安全。。。似乎我需要用到反射才能够根据locale选择模板了。。。让我去死吧。。。</p>
</blockquote>
<p>(虽然我用的是1.x版本，没有Scala的解决方案，但因为项目页面简单，没有过多的层级调用，所以体会到的还是有些方便；至于国际化好像没做不好评价)</p>
<h3 id="4-Comet"><a href="#4-Comet" class="headerlink" title="4. Comet"></a>4. Comet</h3><blockquote>
<p>Play内置Comet支持，看上去非常方便，然而当我终于搞明白它是如何实现comet的时候，我实在忍不住喷了满屏的口水，再放声大笑。。。这是整个Play框架中最富娱乐精神的实现，绝对可以入围2012年度最佳编程娱乐奖的评选活动。通常Comet的实现有很多种办法，典型的无非是ajax based long pulling, iframe based long pulling, websocket based server side pushing，你们还能想出其他的办法吗？Play给出了一个绝佳的方案，http chunk based server side pushing via iframe。不明白http chunk的同学请自行google，我简单的解释一下就是，在iframe中发起一个访问，然后服务端不会关闭http连接，而是返回基于chunk的应答，这样，客户端浏览器就会意识到服务器的应答没有结束而一直保持连接，服务端如何有事件发生，就返回一个chunk，通常是一段javascript代码，然后浏览器收到一个chunk，在等待下一个chunk的同时，执行javascript，实现了一个完美的server push机制。Wow，看上去非常perfect哈，不过请大家想像一个浏览器在处理一个长连接的时候会是怎样的动作？答案是浏览器会显示沙漏图标提示网页正在下载中，即使它是一个隐藏的iframe也是一样，于是，你就会发现，你的浏览器上会有一个转圈的图标在不停的转啊转啊，然后像我这样愚蠢的用户就会手贱的点停止，嗯，很好，不转了，整个世界清静了，太清静啦，浏览器不再接受服务端的response了，连接被关闭了，comet也over了。。。</p>
</blockquote>
<p>(长连接的需求实话说不常见，一般而言也应该尽可能避免因为对服务器资源消耗很大，所以其实支不支持都无所谓，如果真有需要可以另行搭建一套websocket.)</p>
<h3 id="5-文档支持"><a href="#5-文档支持" class="headerlink" title="5. 文档支持"></a>5. 文档支持</h3><blockquote>
<p>Play试图提供一个完整的web开发的生态环境，可是如此伟大的目标，显示不是官网上那点step by step性质的文档可以支持的，可是我找不到更多的文档了，官网提供的文档足够我开发一个玩具应用了，然而，也仅此而已了。</p>
</blockquote>
<p>(比起文档，我更倾向于是生态的原因，根源就是上面的第一点)</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/24/centos-install-nodejs/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/joygto.jpg">
      <meta itemprop="name" content="Samy">
      <meta itemprop="description" content="心如花木 向阳而生">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="三米阳光">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/24/centos-install-nodejs/" class="post-title-link" itemprop="url">centos install nodejs</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-02-24 20:41:15 / 修改时间：20:43:27" itemprop="dateCreated datePublished" datetime="2021-02-24T20:41:15+08:00">2021-02-24</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/nodejs/" itemprop="url" rel="index"><span itemprop="name">nodejs</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="centos自带的nodejs版本非常古老，往往是需要更新的，然而更新过程中会有一些坑，下面给出一个推荐方案已经一些备选方案"><a href="#centos自带的nodejs版本非常古老，往往是需要更新的，然而更新过程中会有一些坑，下面给出一个推荐方案已经一些备选方案" class="headerlink" title="centos自带的nodejs版本非常古老，往往是需要更新的，然而更新过程中会有一些坑，下面给出一个推荐方案已经一些备选方案."></a>centos自带的nodejs版本非常古老，往往是需要更新的，然而更新过程中会有一些坑，下面给出一个推荐方案已经一些备选方案.</h4><h3 id="推荐方案-nvm"><a href="#推荐方案-nvm" class="headerlink" title="推荐方案 (nvm)"></a>推荐方案 (nvm)</h3><p>nvm全称Node Version Manager是 Nodejs 版本管理器，它让我们能方便的对 Node.js 的版本进行切换。 nvm 的官方版本只支持 Linux 和 Mac。 Windows 用户，可以用 nvm-windows。详情请点击<a target="_blank" rel="noopener" href="http://nvm.sh/">官方说明</a>。</p>
<ul>
<li><p>下载安装环境:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -qO- https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;creationix&#x2F;nvm&#x2F;v0.33.11&#x2F;install.sh | bash</span><br></pre></td></tr></table></figure></li>
<li><p>重启终端环境 (安装过程中如果有报错也不用管, 还是重启终端)</p>
</li>
<li><p>输入nvm ls-remote列出所有可用的版本</p>
</li>
<li><p>nvm install v10.5.0 (这里版本可以是上面列出来的任意)</p>
</li>
</ul>
<p>然后你就会发现node跟npm都装好了，可以命令node -v 和npm -v 验证, 而且你可以随时查看当前的node版本: nvm current以及切换当前node版本: nvm use 版本号</p>
<h5 id="该方案避免了一些什么Segmentation-fault之类的坑，之前试过用yum-install-nodejs-用wget下载nodejs包然后gcc编译安装，试过切换过yum源，试过npm-install-g-n-然后用n-stable安装等等都报Segmentation-fault-只有nvm一切顺利"><a href="#该方案避免了一些什么Segmentation-fault之类的坑，之前试过用yum-install-nodejs-用wget下载nodejs包然后gcc编译安装，试过切换过yum源，试过npm-install-g-n-然后用n-stable安装等等都报Segmentation-fault-只有nvm一切顺利" class="headerlink" title="该方案避免了一些什么Segmentation fault之类的坑，之前试过用yum install nodejs, 用wget下载nodejs包然后gcc编译安装，试过切换过yum源，试过npm install -g n 然后用n stable安装等等都报Segmentation fault, 只有nvm一切顺利."></a>该方案避免了一些什么Segmentation fault之类的坑，之前试过用yum install nodejs, 用wget下载nodejs包然后gcc编译安装，试过切换过yum源，试过npm install -g n 然后用n stable安装等等都报Segmentation fault, 只有nvm一切顺利.</h5><h3 id="1-源码安装"><a href="#1-源码安装" class="headerlink" title="1. 源码安装"></a>1. 源码安装</h3><ul>
<li><p>下载源码</p>
<p>官网查看最新版本链接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http:&#x2F;&#x2F;nodejs.org&#x2F;dist&#x2F;v0.10.30&#x2F;node-v0.10.30.tar.gz</span><br></pre></td></tr></table></figure></li>
<li><p>解压源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar xzvf node-v* &amp;&amp; cd node-v*</span><br></pre></td></tr></table></figure></li>
<li><p>安装必要的编译软件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install gcc gcc-c++</span><br></pre></td></tr></table></figure></li>
<li><p>编译&amp;安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;configure</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure></li>
<li><p>查看版本（测试安装是否成功）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node -v</span><br></pre></td></tr></table></figure>
<h3 id="2-使用已编译版本安装"><a href="#2-使用已编译版本安装" class="headerlink" title="2. 使用已编译版本安装"></a>2. 使用已编译版本安装</h3></li>
<li><p>下载已编译版本, 最新版本可以点</p>
<p>这里查看</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http:&#x2F;&#x2F;nodejs.org&#x2F;dist&#x2F;v0.10.30&#x2F;node-v0.10.30-linux-x64.tar.gz</span><br></pre></td></tr></table></figure></li>
<li><p>解压</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar --strip-components 1 -xzvf node-v* -C &#x2F;usr&#x2F;local</span><br></pre></td></tr></table></figure></li>
<li><p>测试安装是否成功</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node -v</span><br></pre></td></tr></table></figure>
<h3 id="3-使用EPEL安装"><a href="#3-使用EPEL安装" class="headerlink" title="3. 使用EPEL安装"></a>3. 使用EPEL安装</h3></li>
<li><p>下载EPEL</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -i http:&#x2F;&#x2F;download.fedoraproject.org&#x2F;pub&#x2F;epel&#x2F;beta&#x2F;7&#x2F;x86_64&#x2F;epel-release-7-0.2.noarch.rpm</span><br></pre></td></tr></table></figure></li>
<li><p>安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install nodejs</span><br></pre></td></tr></table></figure></li>
<li><p>测试安装是否成功</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node -v</span><br></pre></td></tr></table></figure></li>
<li><p>(可选)安装npm管理包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install npm</span><br></pre></td></tr></table></figure>
<h3 id="4-全部yum搞定-其实也是第三点的EPEL"><a href="#4-全部yum搞定-其实也是第三点的EPEL" class="headerlink" title="4. 全部yum搞定(其实也是第三点的EPEL)"></a>4. 全部yum搞定(其实也是第三点的EPEL)</h3></li>
<li><p>安装epel库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install epel-release</span><br></pre></td></tr></table></figure></li>
<li><p>安装nodejs</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install nodejs</span><br></pre></td></tr></table></figure>
<h3 id="总结-nvm还是官方最推荐的方式，即便是在windows下也有对应的nvm-windows-而且任何版本随心切换"><a href="#总结-nvm还是官方最推荐的方式，即便是在windows下也有对应的nvm-windows-而且任何版本随心切换" class="headerlink" title="总结: nvm还是官方最推荐的方式，即便是在windows下也有对应的nvm-windows, 而且任何版本随心切换."></a>总结: nvm还是官方最推荐的方式，即便是在windows下也有对应的nvm-windows, 而且任何版本随心切换.</h3></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Samy"
      src="/images/joygto.jpg">
  <p class="site-author-name" itemprop="name">Samy</p>
  <div class="site-description" itemprop="description">心如花木 向阳而生</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">6</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Samy</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
